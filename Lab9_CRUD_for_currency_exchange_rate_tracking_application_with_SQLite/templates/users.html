<!DOCTYPE html> <!-- объявляем тип документа как HTML5 для совместимости с современными браузерами -->
<html lang="ru"> <!-- открываем корневой элемент HTML с указанием русского языка содержимого -->
<head> <!-- открываем секцию head для метаданных страницы и стилей -->
    <meta charset="UTF-8"> <!-- устанавливаем кодировку UTF-8 для корректного отображения русских символов и специальных знаков -->
    <title>{{ myapp.name }} - Пользователи</title> <!-- задаём динамический заголовок вкладки браузера с названием приложения и страницы -->
    <style> /* открываем блок встроенных стилей CSS для оформления страницы */
        /* Блок стилей для всего тела документа */
        body { 
            font-family: Arial, sans-serif; /* устанавливаем основной шрифт Arial с универсальным запасным вариантом */
            margin: 40px; /* задаём внешние отступы по 40 пикселей со всех сторон страницы */
        }
        /* Блок стилей для блока навигации */
        .nav { 
            margin: 20px 0; /* устанавливаем вертикальные отступы в 20 пикселей сверху и снизу навигационного блока */
        }
        /* Блок стилей для ссылок внутри навигации */
        .nav a { 
            margin-right: 15px; /* добавляем правый отступ в 15 пикселей для создания промежутков между ссылками */
            text-decoration: none; /* убираем стандартное подчёркивание у ссылок */
            color: #0066cc; /* задаём синий цвет текста ссылок */
        }
        /* Блок стилей для ссылок при наведении курсора мыши */
        .nav a:hover { 
            text-decoration: underline; /* добавляем подчёркивание при наведении для визуальной обратной связи */
        }
        /* Блок стилей для таблицы со списком пользователей */
        table { 
            border-collapse: collapse; /* объединяем границы соседних ячеек таблицы в единую линию */
            width: 100%; /* растягиваем таблицу на всю доступную ширину контейнера */
            margin: 20px 0; /* добавляем вертикальные отступы в 20 пикселей сверху и снизу таблицы */
        }
        /* Блок общих стилей для заголовочных и обычных ячеек таблицы */
        th, td { 
            border: 1px solid #ddd; /* добавляем светло-серую рамку толщиной 1 пиксель вокруг каждой ячейки */
            padding: 12px; /* задаём внутренние отступы в 12 пикселей для содержимого ячеек */
            text-align: left; /* выравниваем текст в ячейках по левому краю */
        }
        /* Блок специфических стилей для заголовочных ячеек таблица */
        th { 
            background-color: #f2f2f2; /* устанавливаем светло-серый фон для заголовков столбцов */
        }
        /* Блок стилей для строк таблицы при наведении курсора мыши */
        tr:hover { 
            background-color: #f5f5f5; /* устанавливаем светло-серый фон для строки при наведении курсора */
        }
        /* Блок стилей для ссылок "подробнее" в таблице */
        .details-link { 
            color: #4CAF50; /* устанавливаем зелёный цвет для ссылок "подробнее" */
            text-decoration: none; /* убираем стандартное подчёркивание у ссылок */
        }
        .details-link:hover { 
            text-decoration: underline; /* добавляем подчёркивание при наведении */
        }
        /* Блок стилей для сообщений */
        .message { 
            padding: 10px; /* задаём внутренние отступы в 10 пикселей для сообщений */
            margin: 10px 0; /* добавляем вертикальные отступы в 10 пикселей сверху и снизу сообщений */
            border-radius: 5px; /* скругляем углы сообщений на 5 пикселей */
            font-weight: bold; /* устанавливаем жирное начертание шрифта для сообщений */
        }
        .success { 
            background-color: #dff0d8; /* устанавливаем светло-зелёный фон для успешных сообщений */
            color: #3c763d; /* задаём тёмно-зелёный цвет текста для успешных сообщений */
            border: 1px solid #d6e9c6; /* добавляем светло-зелёную рамку толщиной 1 пиксель */
        }
        .error { 
            background-color: #f2dede; /* устанавливаем светло-красный фон для сообщений об ошибках */
            color: #a94442; /* задаём тёмно-красный цвет текста для сообщений об ошибках */
            border: 1px solid #ebccd1; /* добавляем светло-красную рамку толщиной 1 пиксель */
        }
        .info { 
            background-color: #d9edf7; /* устанавливаем светло-голубой фон для информационных сообщений */
            color: #31708f; /* задаём тёмно-синий цвет текста для информационных сообщений */
            border: 1px solid #bce8f1; /* добавляем голубую рамку толщиной 1 пиксель */
        }
        /* Блок стилей для статистики */
        .stats { 
            background: #f5f5f5; /* устанавливаем светло-серый фон для блока статистики */
            padding: 10px; /* задаём внутренние отступы в 10 пикселей для содержимого блока */
            border-radius: 5px; /* скругляем углы блока на 5 пикселей */
            margin: 10px 0; /* добавляем вертикальные отступы в 10 пикселей сверху и снизу блока */
        }
    </style> <!-- закрываем блок встроенных стилей -->
</head> <!-- закрываем секцию head -->
<body> <!-- открываем тело документа, где размещается видимое содержимое страницы -->
    <h1>{{ myapp.name }}</h1> <!-- задаём заголовок первого уровня с динамическим названием приложения -->
    
    <div class="nav"> <!-- открываем блок навигации по сайту -->
        <a href="/">Главная</a> <!-- задаём ссылку для перехода на главную страницу приложения -->
        <a href="/users">Пользователи</a> <!-- задаём ссылку на текущую страницу -->
        <a href="/currencies">Курсы валют</a> <!-- задаём ссылку для перехода на страницу курсов валют -->
        <a href="/author">Об авторе</a> <!-- задаём ссылку для перехода на страницу с информацией об авторе -->
    </div> <!-- закрываем блок навигации -->
    
    <h2>Список пользователей ({{ users|length }})</h2> <!-- задаём заголовок второго уровня с динамическим количеством пользователей через фильтр length -->
    
    {% if message %} <!-- проверяем, есть ли сообщение для отображения -->
    <div class="message {{ message_type }}"> <!-- открываем блок сообщения с динамическим классом типа сообщения -->
        {{ message }} <!-- выводим текст сообщения -->
    </div> <!-- закрываем блок сообщения -->
    {% endif %} <!-- закрываем блок условного отображения сообщения -->
    
    <div class="stats"> <!-- открываем блок статистики -->
        <strong>Общая статистика:</strong> <!-- задаём заголовок статистики -->
        Всего пользователей: {{ users|length }} | <!-- выводим общее количество пользователей -->
        Всего подписок: {{ total_subscriptions }} <!-- выводим общее количество подписок -->
    </div> <!-- закрываем блок статистики -->
    
    <table> <!-- открываем таблицу для отображения списка пользователей -->
        <thead> <!-- открываем секцию заголовка таблицы -->
            <tr> <!-- открываем строку заголовков столбцов -->
                <th>ID</th> <!-- задаём заголовок столбца с уникальным идентификатором пользователя -->
                <th>Имя</th> <!-- задаём заголовок столбца с именем пользователя -->
                <th>Количество подписок</th> <!-- задаём заголовок столбца с количеством подписок пользователя на валюты -->
                <th>Подробная информация</th> <!-- задаём заголовок столбца с ссылками на детальную информацию -->
            </tr> <!-- закрываем строку заголовков -->
        </thead> <!-- закрываем секцию заголовка таблицы -->
        <tbody> <!-- открываем секцию тела таблицы с данными пользователей -->
            {% for user in users %} <!-- открываем цикл Jinja2 для перебора всех пользователей из списка users -->
            <tr> <!-- открываем строку таблицы для одного пользователя -->
                <td>{{ user.id }}</td> <!-- задаём ячейку с уникальным идентификатором пользователя -->
                <td>{{ user.name }}</td> <!-- задаём ячейку с именем пользователя -->
                <td> <!-- открываем ячейку для отображения количества подписок пользователя -->
                    {% if user.subscription_count and user.subscription_count > 0 %} <!-- проверяем, есть ли подписки -->
                    {{ user.subscription_count }} <!-- выводим количество подписок -->
                    {% else %} <!-- если подписок нет -->
                    <span style="color: #999; font-style: italic;">Нет подписок</span> <!-- выводим сообщение об отсутствии подписок -->
                    {% endif %} <!-- закрываем блок условного отображения -->
                </td> <!-- закрываем ячейку с количеством подписок -->
                <td> <!-- открываем ячейку с ссылкой на детальную информацию -->
                    <a href="/user?id={{ user.id }}" class="details-link">Подробнее...</a> <!-- задаём ссылку на страницу детальной информации о пользователе с передачей его ID в параметре запроса -->
                </td> <!-- закрываем ячейку со ссылкой -->
            </tr> <!-- закрываем строку таблицы для текущего пользователя -->
            {% endfor %} <!-- закрываем цикл перебора пользователей -->
        </tbody> <!-- закрываем секцию тела таблицы -->
    </table> <!-- закрываем таблицу -->
    
    <div style="margin-top: 30px;"> <!-- открываем блок с встроенным стилем для отступа сверху -->
        <a href="/">Вернуться на главную</a> <!-- задаём ссылку для возврата на главную страницу приложения -->
    </div> <!-- закрываем блок с ссылкой возврата -->
</body> <!-- закрываем тело документа -->
</html> <!-- закрываем корневой элемент HTML -->