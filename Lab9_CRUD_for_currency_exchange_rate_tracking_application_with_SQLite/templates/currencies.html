<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ myapp.name }} - Курсы валют</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .nav { margin: 20px 0; }
        .nav a { margin-right: 15px; text-decoration: none; color: #0066cc; }
        .nav a:hover { text-decoration: underline; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }
        .action-btn { padding: 5px 10px; margin: 2px; text-decoration: none; border-radius: 3px; font-size: 0.9em; }
        .delete-btn { background-color: #f44336; color: white; }
        .delete-btn:hover { background-color: #d32f2f; }
        .update-btn { background-color: #4CAF50; color: white; }
        .update-btn:hover { background-color: #388E3C; }
        .update-form { display: inline; }
        .update-input { padding: 5px; margin: 2px; width: 80px; }
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #dff0d8; color: #3c763d; border: 1px solid #d6e9c6; }
        .error { background-color: #f2dede; color: #a94442; border: 1px solid #ebccd1; }
        .info { background-color: #d9edf7; color: #31708f; border: 1px solid #bce8f1; }
    </style>
</head>
<body>
<h1>{{ myapp.name }}</h1>

<div class="nav">
    <a href="/">Главная</a>
    <a href="/users">Пользователи</a>
    <a href="/currencies">Курсы валют</a>
    <a href="/author">Об авторе</a>
</div>

<h2>Курсы валют</h2>

{% if message %}
<div class="message {{ message_type }}">
    {{ message }}
</div>
{% endif %}

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>NumCode</th>
        <th>CharCode</th>
        <th>Название</th>
        <th>Курс</th>
        <th>Номинал</th>
        <th>Курс за единицу</th>
        <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    {% for currency in currencies %}
    <tr>
        <td>{{ currency.id }}</td>
        <td>{{ currency.num_code }}</td>
        <td>{{ currency.char_code }}</td>
        <td>{{ currency.name }}</td>
        <td>{{ "%.4f"|format(currency.value) }}</td>
        <td>{{ currency.nominal }}</td>
        <td>{{ "%.4f"|format(currency.value / currency.nominal) }}</td>
        <td>
            <a href="/currency/delete?id={{ currency.id }}" class="action-btn delete-btn"
               onclick="return confirm('Вы уверены, что хотите удалить валюту {{ currency.char_code }}?')">
                Удалить
            </a>
            <br>
            <form action="/currency/update" method="GET" class="update-form">
                <input type="hidden" name="char_code" value="{{ currency.char_code }}">
                <input type="number" name="value" step="0.0001" min="0.0001" value="{{ currency.value }}"
                       class="update-input" required>
                <button type="submit" class="action-btn update-btn">Обновить</button>
            </form>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<h3>Добавить новую валюту</h3>
<!-- ✅ ИСПРАВЛЕНО: Метод изменен на POST -->
<form action="/currency/create" method="POST" style="margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 5px;">
    <div style="margin-bottom: 10px;">
        <label for="num_code">Цифровой код:</label>
        <input type="text" id="num_code" name="num_code" required style="margin-left: 10px; padding: 5px;">
    </div>
    <div style="margin-bottom: 10px;">
        <label for="char_code">Символьный код (3 символа):</label>
        <input type="text" id="char_code" name="char_code" maxlength="3" required
               style="margin-left: 10px; padding: 5px; width: 60px; text-transform: uppercase;">
    </div>
    <div style="margin-bottom: 10px;">
        <label for="name">Название:</label>
        <input type="text" id="name" name="name" required style="margin-left: 10px; padding: 5px; width: 300px;">
    </div>
    <div style="margin-bottom: 10px;">
        <label for="value">Курс:</label>
        <input type="number" id="value" name="value" step="0.0001" min="0.0001" required
               style="margin-left: 10px; padding: 5px;">
    </div>
    <div style="margin-bottom: 10px;">
        <label for="nominal">Номинал:</label>
        <input type="number" id="nominal" name="nominal" min="1" value="1" required
               style="margin-left: 10px; padding: 5px;">
    </div>
    <button type="submit" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">
        Добавить валюту
    </button>
</form>

<div style="margin-top: 30px;">
    <a href="/">Вернуться на главную</a>
</div>
</body>
</html>