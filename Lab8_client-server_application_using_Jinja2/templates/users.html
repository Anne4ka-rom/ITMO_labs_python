<!DOCTYPE html> <!-- объявляем тип документа как HTML5 для поддержки всеми современными браузерами -->
<html lang="ru"> <!-- открываем корневой элемент HTML с указанием русского языка содержимого -->
<head> <!-- открываем секцию head для метаданных страницы и определения стилей -->
    <meta charset="UTF-8"> <!-- устанавливаем кодировку UTF-8 для корректного отображения русских символов -->
    <title>{{ myapp.name }} - Пользователи</title> <!-- задаём динамический заголовок вкладки браузера с названием приложения и указанием страницы -->
    
    <style> /* открываем блок встроенных стилей CSS для оформления элементов страницы */
        /* Блок стилей для всего тела документа */
        body { 
            font-family: Arial, sans-serif; /* устанавливаем основной шрифт Arial с универсальным запасным вариантом sans-serif */
            margin: 40px; /* задаём внешние отступы в 40 пикселей со всех сторон страницы */
        }
        
        /* Блок стилей для навигационной панели */
        .nav { 
            margin: 20px 0; /* устанавливаем вертикальные отступы в 20 пикселей сверху и снизу навигационного блока */
        }
        
        /* Блок стилей для ссылок внутри навигационной панели */
        .nav a { 
            margin-right: 15px; /* добавляем правый отступ в 15 пикселей для создания промежутков между ссылками */
            text-decoration: none; /* убираем стандартное подчёркивание у ссылок */
            color: #0066cc; /* задаём синий цвет текста ссылок */
        }
        
        /* Блок стилей для ссылок при наведении курсора мыши */
        .nav a:hover { 
            text-decoration: underline; /* добавляем подчёркивание при наведении */
        }
        
        /* Блок стилей для таблицы со списком пользователей */
        table { 
            border-collapse: collapse; /* объединяем границы соседних ячеек таблицы в единую линию */
            width: 100%; /* растягиваем таблицу на всю доступную ширину контейнера */
            margin: 20px 0; /* добавляем вертикальные отступы в 20 пикселей сверху и снизу таблицы */
        }
        
        /* Блок стилей для заголовочных и обычных ячеек таблицы */
        th, td { 
            border: 1px solid #ddd; /* добавляем светло-серую рамку толщиной 1 пиксель вокруг каждой ячейки */
            padding: 12px; /* задаём внутренние отступы в 12 пикселей для содержимого ячеек */
            text-align: left; /* выравниваем текст в ячейках по левому краю */
        }
        
        /* Блок стилей для заголовочных ячеек таблицы */
        th { 
            background-color: #f2f2f2; /* устанавливаем светло-серый фон для заголовков столбцов */
        }
        
        /* Блок стилей для строк таблицы при наведении курсора мыши */
        tr:hover { 
            background-color: #f5f5f5; /* устанавливаем светло-серый фон для строки при наведении */
        }
        
        /* Блок стилей для ссылок "подробнее" в таблице */
        .details-link { 
            color: #4CAF50; /* задаём зелёный цвет текста для ссылок детальной информации */
        }
    </style> <!-- закрываем блок встроенных стилей -->
</head> <!-- закрываем секцию head -->

<body> <!-- открываем тело документа, где размещается видимое содержимое страницы списка пользователей -->
    <h1>{{ myapp.name }}</h1> <!-- задаём заголовок первого уровня с динамическим названием приложения -->
    
    <div class="nav"> <!-- открываем блок основной навигации по приложению -->
        <a href="/">Главная</a> <!-- задаём ссылку на главную страницу приложения -->
        <a href="/users">Пользователи</a> <!-- задаём ссылку на текущую страницу -->
        <a href="/currencies">Курсы валют</a> <!-- задаём ссылку на страницу с актуальными курсами валют -->
        <a href="/author">Об авторе</a> <!-- задаём ссылку на страницу с информацией об авторе приложения -->
    </div> <!-- закрываем блок навигации -->
    
    <h2>Список пользователей ({{ users|length }})</h2> <!-- задаём заголовок второго уровня с динамическим количеством пользователей через фильтр length -->
    
    <table> <!-- открываем таблицу для отображения списка пользователей -->
        <thead> <!-- открываем секцию заголовка таблицы -->
            <tr> <!-- открываем строку заголовков столбцов -->
                <th>ID</th> <!-- задаём заголовок столбца с уникальным идентификатором пользователя -->
                <th>Имя</th> <!-- задаём заголовок столбца с именем пользователя -->
                <th>Количество подписок</th> <!-- задаём заголовок столбца с количеством подписок пользователя на валюты -->
                <th>Подробная информация</th> <!-- задаём заголовок столбца с ссылками на детальную информацию -->
            </tr> <!-- закрываем строку заголовков -->
        </thead> <!-- закрываем секцию заголовка таблицы -->
        <tbody> <!-- открываем секцию тела таблицы с данными пользователей -->
            {% for user in users %} <!-- открываем цикл Jinja2 для перебора всех пользователей из списка users -->
            <tr> <!-- открываем строку таблицы для одного пользователя -->
                <td>{{ user.id }}</td> <!-- задаём ячейку с уникальным идентификатором пользователя -->
                <td>{{ user.name }}</td> <!-- задаём ячейку с именем пользователя -->
                <td> <!-- открываем ячейку для подсчёта количества подписок пользователя -->
                    {% set count = namespace(value=0) %} <!-- создаём пространство имён count с переменной value для подсчёта подписок -->
                    {% for sub in user_currencies %} <!-- открываем вложенный цикл для перебора всех связей пользователь-валюта -->
                        {% if sub.user_id == user.id %} <!-- проверяем, относится ли текущая связь к текущему пользователю -->
                            {% set count.value = count.value + 1 %} <!-- увеличиваем счётчик подписок на 1 -->
                        {% endif %} <!-- закрываем блок условного оператора -->
                    {% endfor %} <!-- закрываем вложенный цикл перебора связей -->
                    {{ count.value }} <!-- выводим итоговое количество подписок для текущего пользователя -->
                </td> <!-- закрываем ячейку с количеством подписок -->
                <td> <!-- открываем ячейку с ссылкой на детальную информацию -->
                    <a href="/user?id={{ user.id }}" class="details-link">Подробнее...</a> <!-- задаём ссылку на страницу детальной информации о пользователе с передачей его ID в параметре запроса -->
                </td> <!-- закрываем ячейку со ссылкой -->
            </tr> <!-- закрываем строку таблицы для текущего пользователя -->
            {% endfor %} <!-- закрываем цикл перебора пользователей -->
        </tbody> <!-- закрываем секцию тела таблицы -->
    </table> <!-- закрываем таблицу -->
    
    <div style="margin-top: 30px;"> <!-- открываем блок с встроенным стилем для отступа сверху -->
        <a href="/">Вернуться на главную</a> <!-- задаём ссылку для возврата на главную страницу приложения -->
    </div> <!-- закрываем блок с ссылкой возврата -->
</body> <!-- закрываем тело документа -->
</html> <!-- закрываем корневой элемент HTML -->